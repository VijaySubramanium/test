<app-spinner></app-spinner>
<p-toast [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"></p-toast>
<div class="col-md-12 mb-3">
  <div class="dashboard-card-wrapper">
    <div class="dashboard-label">

      <h2 *ngIf="typeOfAvg == 'filterWise'">Avg. Score</h2>
      <h2 *ngIf="typeOfAvg == 'yearWise'">Year-wise Average Score</h2>
      <div class="d-flex">

        <select class="form-select me-2" #selectList2 (change)="yearFilter(selectList2.value)">
          <option  value="">Select Year</option>
          <option *ngFor="let x of yearArray" value="{{x}}">Year - {{x}}</option>
        </select>

        <button class="btn filter-btn btn-get me-2 p-2" data-tooltip="Filter"
          [ngClass]="addFilter ? 'btn-blue' : 'no-filter'" href="javascript:void(0);" data-bs-toggle="modal"
          [attr.data-bs-target]="'#filter'" (click)="onFilter(addFilter)"><i class="las la fa-filter"></i></button>

        <button *ngIf="typeOfAvg == 'filterWise'" class="download-btn" data-tooltip="Batch-Score Download" type="button" (click)="downloadPDF('fb')">
          <i class="las la-file-download"></i>
        </button>

        <button *ngIf="typeOfAvg == 'yearWise'" class="download-btn" data-tooltip="Year-Score Download" type="button" (click)="downloadPDF('yfb')">
          <i class="las la-file-download"></i>
        </button>
      </div>
    </div>


    <div class="canvas-inner-wrapper">
      <div class="canvas-wrapper mx-auto w-100">
        <div class="canvas-inner" *ngIf="typeOfAvg == 'filterWise'">
          <highcharts-chart id="singlebarChart" class="mychart" *ngIf="fbData?.length>0" [Highcharts]="Highcharts"
            [options]="fbChart" style="width: 100%; height: 500; display: block;">
          </highcharts-chart>
          <div class="p-4 text-center" style="width: 100%; display: block; font-weight: 500;" *ngIf="fbData?.length==0">
            No data found for this graph</div>
        </div>

        <div class="canvas-inner" *ngIf="typeOfAvg == 'yearWise'">
          <highcharts-chart id="singlebarChart2" class="mychart" *ngIf="fbYearData?.length>0" [Highcharts]="Highcharts"
            [options]="fbYearChart2" style="width: 100%; height: 500; display: block;">
          </highcharts-chart>
          <div class="p-4 text-center" style="width: 100%; display: block; font-weight: 500;"
            *ngIf="fbYearData?.length==0">No data found for this graph</div>
        </div>
      </div>

    </div>
  </div>

</div>


<div class="modal fade" id="filter" tabindex="-1" aria-labelledby="filter" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Filters</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div>
        <div class="row m-4 justify-content-around">
          <div class="col-lg-6 respon">
            <div class="d-flex mt-1">
              <p-multiSelect class="min-width" [resetFilterOnHide]="true" [options]="activeProjectList"
                [(ngModel)]="_selectedProjects" optionLabel="project_name" (onChange)="columnFilter($event,'projects')"
                placeholder="Select Projects" [showToggleAll]="false">
              </p-multiSelect>
              <button class="btn btn-blue btn-get" [disabled]="!isProjectSelect" (click)="getTrainersByProjectId()"><i
                  class="las la la-arrow-right"></i></button>
            </div>
          </div>
          <div class="col-lg-6 respon">
            <div class="d-flex mt-1">
              <p-multiSelect class="min-width" [resetFilterOnHide]="true" [options]="trainerDetails"
                [(ngModel)]="_selectedTrainer" optionLabel="trainer_name" (onChange)="columnFilter($event,'trainers')"
                defaultLabel="Select Trainers" [disabled]="!trainerDetails" [showToggleAll]="false"></p-multiSelect>
              <button class="btn btn-blue btn-get" [disabled]="!isTrainerSelect" (click)="getBatchsByProjTrainerId()"><i
                  class="las la la-arrow-right"></i></button>
            </div>
          </div>
        </div>

        <div class="row m-4 justify-content-around">
          <div class="col-lg-6 respon">
            <div class="d-flex mt-1">
              <p-multiSelect class="min-width" [resetFilterOnHide]="true" [options]="batchDetails"
                [(ngModel)]="_selectedBatches" optionLabel="batchcode" (onChange)="columnFilter($event,'batches')"
                placeholder="Select Batches" [disabled]="!batchDetails" [showToggleAll]="false"></p-multiSelect>

            </div>
            <span class="text-danger p-1" *ngIf="isMandBatch">Batch is mandatory with trainer*</span>
          </div>
          <div class="col-lg-6 respon">
            <p-calendar class="dashboard-calendar" title="Date Filter" [(ngModel)]="rangeScore" placeholder="Date range"
              selectionMode="range" [readonlyInput]="true" [maxDate]="maxDateValue" #fbCalendar inputId="range">
              <p-footer>
                <button class="p-1" pButton type="button" label="Close" (click)="fbCalendar.hideOverlay()">
                </button>
              </p-footer>
            </p-calendar>

          </div>
        </div>
        <div class="row m-4 justify-content-end">
          <div class="col-lg-6 d-flex justify-content-end mt-4">
            <button class="btn btn-red btn-get me-3 ps-2 pe-2" data-bs-dismiss="modal" aria-label="Close"
              (click)="clearFilter()">Clear Filters</button>
            <button class="btn btn-blue btn-get ps-4 pe-4" (click)="goFb('filter')">Apply</button>
          </div>

        </div>

      </div>
    </div>
  </div>
</div>
